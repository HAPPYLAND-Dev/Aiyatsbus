

#         Powered by TabooLib 6.2         #


basic:
  id: jelly_legs
  name: "弹跳鞋"
  max_level: 3

rarity: 精良
targets:
  - 靴子

limitations: [ ]

display:
  description:
    general: "摔伤时可减少伤害并弹起"
    specific: "&7受到不超过&a{最大高度}&7的摔伤时减少&a{减少伤害}&7并弹起"

variables:
  leveled:
    最大高度:
      1: 16
      2: 48
      3: 256
      unit: "格"
    减少伤害: "点:3*{level}"

mechanisms:
  listeners:
    on-entity-damage:
      type: "fluxon"
      listen: "entity-damage"
      # 下面有个公式建议不要修改, 已调整至最平衡 (set y to calc "0.1804 * height - 0.0044 * height * height + 0.00004 * height * height * height")
      # 受到伤害小于0时取消伤害
      handle: |-
        fallDistance = &event::entity()::fallDistance()
        height = &fallDistance / 2.0

        if string(&event::cause()) == FALL then {
            if &fallDistance <= &最大高度 then {
                // 这个公式不建议修改, 已调整至最平衡
                y = 0.1804 * &height - 0.0044 * &height + 0.00004 * pow(&height, 3)
                &event::entity()::setVelocity(vector(0, &y, 0))

                delta = &event::damage() - &减少伤害
                // FIXME: 受到伤害小于 0 时取消伤害暂时有一些问题
                if &event::damage() - &减少伤害 <= 0.0 then {
                    &event::setCancelled(true)
                } else {
                    &event::setDamage(&delta)
                }
            }
        }