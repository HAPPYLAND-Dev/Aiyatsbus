

#         Powered by TabooLib 6.2         #


basic:
  id: wings
  name: "反重力"
  max-level: 3

rarity: 异宝
targets:
  - 靴子

limitations:
  - "CONFLICT_ENCHANT:经验修补"

display:
  description:
    general: "可进入飞行状态，飞行时持续消耗装备耐久"
    specific: "&7可进入飞行状态，飞行时每&a2秒&7消耗装备&a{消耗耐久}&7耐久"

variables:
  leveled:
    消耗耐久: "点:4-{level}"

mechanisms:
  listeners:
    on-fall:
      type: fluxon
      listen: "entity-damage"
      handle: |-
        if &event::cause() == FALL && &player::hasMeta("fall-protect") then {
            &player::removeMeta("fall-protect")
            &event::setCancelled(true)
        }
  tickers:
    durability:
      type: fluxon
      interval: 40
      pre-handle: |-
        damage = (&item::type::maxDurability() - &item::durability()) / &item::type::maxDurability() <= 0.1
        if (&player::gameMode() == SURVIVAL || &player::gameMode() == ADVENTURE) && !&damage then {
            print(1)
            &player::setAllowFlight(true)
        }
      handle: |-
        damage = (&item::type::maxDurability() - &item::durability()) / &item::type::maxDurability() <= 0.1
        if &player::gameMode() == SURVIVAL || &player::gameMode() == ADVENTURE then {
          if &player::isOnGround() && &player::hasMeta("fall-protect") then {
              &player::removeMeta("fall-protect")
          }
          if !&player::allowFlight() && !&damage then {
              &player::setAllowFlight(true)
          }
          if &damage && &player::isFlying() then {
              &player::setFlying(false)
              &player::setAllowFlight(false)
              &player::setMeta("fall-protect", 1)
              return
          }
          if &player::isFlying() then {
              &item::setDurability(&item::durability() + &消耗耐久)
          }
        }
      post-handle: |-
        if &player::gameMode() == SURVIVAL || &player::gameMode() == ADVENTURE then {
            &player::setFlying(false)
            &player::setAllowFlight(false)
        }